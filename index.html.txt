<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Safari Princeza 3.0</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ff69b4">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family:Arial;
    text-align:center;
    background:linear-gradient(#ffd6ec,#ffeaa7);
    margin:0;
    padding:10px;
}
h1{color:#e84393;}
#box{
    background:white;
    padding:15px;
    border-radius:20px;
    max-width:420px;
    margin:auto;
    box-shadow:0 0 20px rgba(0,0,0,0.2);
}
button{
    padding:8px;
    margin:4px;
    border-radius:12px;
    border:none;
    background:#ff69b4;
    color:white;
}
input{
    padding:6px;
    font-size:16px;
    border-radius:8px;
}
.avatar{
    font-size:50px;
}
.map span{
    font-size:30px;
    margin:8px;
    cursor:pointer;
}
.hidden{display:none;}
</style>
</head>
<body>

<h1>ğŸ‘‘ Safari Princeza 3.0 ğŸ¦</h1>

<div id="box">

<div id="profile">
<input type="text" id="name" placeholder="Ime princeze">
<button onclick="startGame()">PoÄni</button>
</div>

<div id="game" class="hidden">

<div class="avatar" id="avatar">ğŸ‘§</div>
<p>Zvezdice: <span id="stars">0</span> â­</p>

<div class="map">
<span onclick="setLevel(1)">ğŸŒ¸</span>
<span onclick="setLevel(2)">ğŸ¦’</span>
<span onclick="setLevel(3)">ğŸ¦</span>
</div>

<h2 id="question"></h2>
<input type="number" id="answer">
<br>
<button onclick="checkAnswer()">Proveri</button>

<p id="result"></p>
<p>OtkljuÄane Å¾ivotinje: <span id="animals">0</span> ğŸ¾</p>

<hr>
<button onclick="openParent()">Roditeljski panel ğŸ”</button>

</div>

<div id="parent" class="hidden">
<input type="password" id="pin" placeholder="PIN">
<button onclick="checkPin()">UÄ‘i</button>
<div id="stats" class="hidden">
<canvas id="chart"></canvas>
</div>
</div>

</div>

<audio id="bgMusic" loop>
<source src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b3d4b.mp3">
</audio>

<audio id="correctSound">
<source src="https://assets.mixkit.co/sfx/preview/mixkit-kids-cheering-532.mp3">
</audio>

<script>
let player="";
let level=1;
let correctAnswer=0;
let stars=0;
let animals=0;
let today=new Date().toLocaleDateString();
const PIN="1234";

function startGame(){
    player=document.getElementById("name").value;
    if(player==="") return;
    localStorage.setItem("sp3_player",player);
    document.getElementById("profile").classList.add("hidden");
    document.getElementById("game").classList.remove("hidden");
    document.getElementById("bgMusic").play();
    loadProgress();
    generateQuestion();
}

function loadProgress(){
    stars=parseInt(localStorage.getItem(player+"_stars")||0);
    animals=parseInt(localStorage.getItem(player+"_animals")||0);
    document.getElementById("stars").innerText=stars;
    document.getElementById("animals").innerText=animals;
    updateAvatar();
}

function updateAvatar(){
    if(stars>=20) document.getElementById("avatar").innerText="ğŸ‘¸";
    else if(stars>=10) document.getElementById("avatar").innerText="ğŸ§šâ€â™€ï¸";
    else document.getElementById("avatar").innerText="ğŸ‘§";
}

function setLevel(l){
    level=l;
    generateQuestion();
}

function generateQuestion(){
    let a=Math.floor(Math.random()*20);
    let b=Math.floor(Math.random()*20);
    let c=Math.floor(Math.random()*10);

    if(level===1){
        a=Math.floor(Math.random()*10);
        b=Math.floor(Math.random()*10);
        correctAnswer=a+b;
        document.getElementById("question").innerText=a+" + "+b+" = ?";
    }

    if(level===2){
        correctAnswer=a-b;
        if(correctAnswer<0) return generateQuestion();
        document.getElementById("question").innerText=a+" - "+b+" = ?";
    }

    if(level===3){
        correctAnswer=a+b-c;
        if(correctAnswer<0||correctAnswer>20) return generateQuestion();
        document.getElementById("question").innerText=a+" + "+b+" - "+c+" = ?";
    }
}

function checkAnswer(){
    let user=parseInt(document.getElementById("answer").value);
    if(user===correctAnswer){
        stars++;
        document.getElementById("correctSound").play();
        document.getElementById("result").innerText="Bravo! â­";
        if(stars%5===0){
            animals++;
            localStorage.setItem(player+"_animals",animals);
        }
        saveDaily();
        localStorage.setItem(player+"_stars",stars);
        document.getElementById("stars").innerText=stars;
        document.getElementById("animals").innerText=animals;
        updateAvatar();
    }else{
        document.getElementById("result").innerText="PokuÅ¡aj ponovo ğŸ’";
    }
    document.getElementById("answer").value="";
    generateQuestion();
}

function saveDaily(){
    let key=player+"_day_"+today;
    let val=parseInt(localStorage.getItem(key)||0);
    val++;
    localStorage.setItem(key,val);
}

function openParent(){
    document.getElementById("parent").classList.remove("hidden");
}

function checkPin(){
    if(document.getElementById("pin").value===PIN){
        showChart();
        document.getElementById("stats").classList.remove("hidden");
    }
}

function showChart(){
    let labels=[];
    let data=[];
    for(let i=6;i>=0;i--){
        let d=new Date();
        d.setDate(d.getDate()-i);
        let ds=d.toLocaleDateString();
        labels.push(ds);
        data.push(parseInt(localStorage.getItem(player+"_day_"+ds)||0));
    }

    new Chart(document.getElementById("chart"),{
        type:"bar",
        data:{
            labels:labels,
            datasets:[{
                label:"TaÄni odgovori",
                data:data
            }]
        }
    });
}

if("serviceWorker" in navigator){
    navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>